+++
title = "6. AWS: ECS"
description = "AWSì˜ ì»¨í…Œì´ë„ˆ ê´€ë¦¬ ì„œë¹„ìŠ¤ì¸ ECSì— ëŒ€í•´ ì•Œì•„ë´…ë‹ˆë‹¤."
icon = "article"
date = "2023-10-30"
lastmod = "2023-10-30"
weight = 360
+++

Amazon ECSëŠ” AWSì—ì„œ ì œê³µí•˜ëŠ” ì»¨í…Œì´ë„ˆ ê´€ë¦¬ ì„œë¹„ìŠ¤ì…ë‹ˆë‹¤. ì¿ ë²„ë„¤í‹°ìŠ¤ì™€ ë¹„ìŠ·í•˜ì§€ë§Œ, ì¡°ê¸ˆ ë” ì‰½ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆì–´ìš”.

ì´ë²ˆ ì‹œê°„ì—ëŠ” ìŠ¤ê¾¸ë”© ì¸í”„ë¼ íŒ€ì˜ ê½ƒì´ë¼ê³  í•  ìˆ˜ ìˆëŠ” ECSì— ëŒ€í•´ ì•Œì•„ë³´ê² ìŠµë‹ˆë‹¤.

## ê³µë¶€í•  ë‚´ìš© ğŸ“š

### 1. ELB

ELBëŠ” AWSì˜ Load Balancer ì„œë¹„ìŠ¤ë¡œ, EC2ì™€ í•¨ê»˜ AWSì—ì„œ ë§ì´ ì‚¬ìš©ë©ë‹ˆë‹¤. ELBë¡œ ìš”ì²­ì„ ë¶„ì‚°ì‹œí‚¤ê³ , EC2 ê°œìˆ˜ë¥¼ ëŠ˜ë¦¬ë©´ì„œ ì„œë²„ì˜ í™•ì¥ì„±ì„ ë†’ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

- Load Balancerì˜ ì£¼ìš” ê¸°ëŠ¥ì„ ì•Œì•„ë´ìš”. (Load Balancing, High Availability, Fault Tolerance)
- ELBì˜ ì¢…ë¥˜ë¥¼ ì•Œì•„ë´ìš”. (Application Load Balancer, Network Load Balancer, Classic Load Balancer)
- ELBì˜ ìš”ê¸ˆì„ ì•Œì•„ë´ìš”.
- ELBì˜ ì£¼ìš” ì„¤ì •ì„ ì•Œì•„ë´ìš”. (Listener, Target Group, Health Check)

#### ì°¸ê³  ìë£Œ

- **["AWS ELB ì‰½ê²Œ ì´í•´í•˜ê¸° #1"](https://aws-hyoh.tistory.com/128)**: ELBì˜ ê¸°ë³¸ ê°œë…ì„ ì •ë¦¬í•´ë†“ì€ ê¸€ì…ë‹ˆë‹¤.
- **[Elastic Load Balancing ìš”ê¸ˆ](https://aws.amazon.com/ko/elasticloadbalancing/pricing/)**: ELBì˜ ìš”ê¸ˆì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### 2. Amazon ECR

Amazon ECRì€ AWSì—ì„œ ì œê³µí•˜ëŠ” Docker Registry ì„œë¹„ìŠ¤ë¡œ, Docker ì´ë¯¸ì§€ë¥¼ ì €ì¥í•˜ê³ , ê´€ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. AWSì—ì„œ ì»¨í…Œì´ë„ˆë¥¼ ì‚¬ìš©í•  ë•ŒëŠ” ECRì„ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì¼ë°˜ì ì´ì˜ˆìš”.

- ECRì´ ì–´ë–¤ ì„œë¹„ìŠ¤ì¸ì§€, ì–´ë–¤ ê¸°ëŠ¥ì„ ì œê³µí•˜ëŠ”ì§€ ì•Œì•„ë´ìš”.
- ë‹¤ë¥¸ ì €ì¥ì†Œ ëŒ€ì‹  ECRì„ ì‚¬ìš©í•˜ëŠ” ì´ìœ ë¥¼ ì•Œì•„ë´ìš”.

#### ì°¸ê³  ìë£Œ

- **["ECRì´ë€?"](https://ks1171-park.tistory.com/107)**: ECRì˜ ê¸°ë³¸ ê°œë…ì„ ì •ë¦¬í•´ë†“ì€ ê¸€ì…ë‹ˆë‹¤.

### 3. Amazon ECS

Amazon ECSëŠ” AWSì—ì„œ ì œê³µí•˜ëŠ” ì»¨í…Œì´ë„ˆ ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜ ì„œë¹„ìŠ¤ë¡œ, ì»¨í…Œì´ë„ˆë¥¼ ì‰½ê²Œ ê´€ë¦¬í•  ìˆ˜ ìˆë„ë¡ ë„ì™€ì¤ë‹ˆë‹¤.

- ECSì˜ ê¸°ë³¸ ê°œë…ì„ ì•Œì•„ë´ìš”.
- ECSì˜ ìš©ì–´ë“¤ê³¼ êµ¬ì„±ì„ ì•Œì•„ë´ìš”. (Cluster, Task Definition, Task, Service)
- ECSì˜ ì‹¤í–‰ ëª¨ë¸ì„ ì•Œì•„ë´ìš”. (Fargate, EC2)
- ECSì˜ ìš”ê¸ˆì„ ì•Œì•„ë´ìš”.

#### ì°¸ê³  ìë£Œ

- **["AWS ECS ì‚´í´ë³´ê¸°"](https://boostbrothers.github.io/technology/2020/01/29/AWS-ECS-%EC%82%B4%ED%8E%B4%EB%B3%B4%EA%B8%B0/)**: ECSì˜ ê¸°ë³¸ ê°œë…ì„ ì •ë¦¬í•´ë†“ì€ ê¸€ì…ë‹ˆë‹¤.
- **["ECS vs EKS, EC2 vs Fargate ë°°í¬ ì„œë¹„ìŠ¤ ë¹„êµí•´ë³´ê¸°"](https://velog.io/@tanggu01/%EB%B0%8D%EA%B8%80-ECS-vs-EKS-EC2-vs-Fargate-%EB%B0%B0%ED%8F%AC-%EC%84%9C%EB%B9%84%EC%8A%A4-%EB%B9%84%EA%B5%90%ED%95%B4%EB%B3%B4%EA%B8%B0)**: ECSì˜ EC2ì™€ Fargateë¥¼ ë¹„êµí•´ë´…ë‹ˆë‹¤.
- **["AWS ECS ìš”ê¸ˆ"](https://aws.amazon.com/ko/ecs/pricing/)**: ECSì˜ ìš”ê¸ˆì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## í”„ë¡œì íŠ¸ ì‹¤ìŠµ ğŸˆ

ì´ë²ˆ ì£¼ì—ëŠ” Node.js ì»¨í…Œì´ë„ˆë¥¼ ECSë¡œ êµ¬ì„±í•´ë´ìš”. ì•„ë˜ ê·¸ë¦¼ì²˜ëŸ¼ ì§€ë‚œ ì£¼ì— EC2ë¡œ ALBì™€ EC2ë¡œ êµ¬ì„±í•œ ë¶€ë¶„ì„ ECSë¡œ ëŒ€ì²´í•  ê±°ì˜ˆìš”.

```mermaid
flowchart LR
  subgraph AWS
    subgraph ECS
      ALB --> Node.js
    end
    style ECS fill:#ffaa90
    CloudFront -- /api/* --> ALB
    CloudFront -- /* --> S3
  end
  Client -- http://[domain-name] --> CloudFront
```

### AWS CLIë¥¼ ì„¤ì¹˜í•˜ì„¸ìš”.

1. [ê³µì‹ ê°€ì´ë“œ](https://docs.aws.amazon.com/ko_kr/cli/latest/userguide/getting-started-install.html)ë¥¼ ì°¸ê³ í•´ ì„¤ì¹˜í•˜ì„¸ìš”.
2. ì„¤ì¹˜ê°€ ì™„ë£Œë˜ë©´, `aws --version` ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•´ ì„¤ì¹˜ê°€ ì˜ ë˜ì—ˆëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”.
3. Management Consoleì—ì„œ IAM Userë¥¼ ìƒì„±í•˜ì„¸ìš”. (`AmazonEC2ContainerRegistryFullAccess` ê¶Œí•œ í•„ìš”)
4. ìƒì„±ëœ IAM Userì˜ "Security Credentials" íƒ­ì—ì„œ access keyë¥¼ ìƒì„±í•˜ì„¸ìš”. (CLI ëª¨ë“œ)
5. í„°ë¯¸ë„ì—ì„œ `aws configure` ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•´ access keyë¥¼ ë“±ë¡í•˜ì„¸ìš”.

### Amazon ECRì— Node.js ì´ë¯¸ì§€ë¥¼ ì €ì¥í•´ìš”.

1. ECR Repositoryë¥¼ ìƒì„±í•˜ì„¸ìš”. (Private ê¶Œì¥!)
2. ë¡œì»¬ì—ì„œ Node.js ì´ë¯¸ì§€ë¥¼ ë§Œë“œì„¸ìš”. (`docker build -t [repository-url] .`)
3. ì•„ë˜ ëª…ë ¹ì–´ë¡œ ECRì— ë¡œê·¸ì¸í•˜ì„¸ìš”. ([region], [aws_account_id]ëŠ” ìˆ˜ì •í•´ì£¼ì„¸ìš”!)
  ```bash
  aws ecr get-login-password --region [region] | docker login --username AWS --password-stdin [aws_account_id].dkr.ecr.[region].amazonaws.com
  ```
4. ì´ë¯¸ì§€ë¥¼ ECRì— ì—…ë¡œë“œí•˜ì„¸ìš”. (`docker push [repository-url]`)
5. ECRì—ì„œ ì´ë¯¸ì§€ë¥¼ í™•ì¸í•˜ì„¸ìš”.

{{< alert context="warning" text="M1/M2 MacBookì—ì„œ ì´ë¯¸ì§€ë¥¼ buildí•˜ë©´ ECSë¥¼ x86ì—ì„œ ì‹¤í–‰í–ˆì„ ë•Œ ì˜¤ë¥˜ê°€ ë‚˜ìš”. ECSì—ì„œ x86 í™˜ê²½ì„ ì‚¬ìš©í•˜ë ¤ë©´ Docker buildë„ x86 í™˜ê²½ì—ì„œ í•´ì£¼ì„¸ìš”!" />}}

### Amazon ECS Clusterë¥¼ ìƒì„±í•˜ì„¸ìš”.

EC2 Launch Typeê³¼ Fargate Launch Type ë‘ ê°€ì§€ ë°©ë²• ì¤‘ í•˜ë‚˜ë¡œ ECS Clusterë¥¼ ìƒì„±í•´ë³´ì„¸ìš”.

{{< alert context="warning" text="**FargateëŠ” Free Tierì— í¬í•¨ë˜ì§€ ì•Šì•„ ê³¼ê¸ˆì´ ìˆì„ ìˆ˜ ìˆì–´ìš”!**<br>ê³¼ê¸ˆì„ ì›ì¹˜ ì•ŠëŠ” ë¶„ë“¤ì€ EC2ë¡œ ì‹¤ìŠµí•´ì£¼ì„¸ìš”." />}}

#### EC2 Launch Type

- ECS Clusterë¥¼ ìƒì„±í•˜ì„¸ìš”.
  - Infrastructureë¡œ EC2ë¥¼ ì„ íƒí•˜ì„¸ìš”.
  - Desired capacityì˜ ìµœì†Ÿê°’ì„ 1ë¡œ ì„¤ì •í•˜ì„¸ìš”.
  - ë„¤íŠ¸ì›Œí¬ ì„¤ì •ì—ì„œ "Auto-assign public IP"ì„ ì¼œì£¼ì„¸ìš”.
- Task Definitionì„ ìƒì„±í•˜ì„¸ìš”.
  - Launch typeì€ EC2ë¡œ ì„¤ì •í•˜ì„¸ìš”.
  - Task sizeëŠ” EC2 ì‚¬ì–‘ë³´ë‹¤ ì‘ê²Œ ì„¤ì •í•˜ì„¸ìš”. ë©”ëª¨ë¦¬ê°€ ë¶€ì¡±í•˜ë©´ ECSê°€ Taskë¥¼ ì‹¤í–‰í•˜ì§€ ëª»í•  ìˆ˜ ìˆì–´ìš”.
  - Containerë¡œ ECR ì´ë¯¸ì§€ë¥¼ ë“±ë¡í•˜ì„¸ìš”.
  - Container Port mappingìœ¼ë¡œ 3000 í¬íŠ¸ë¥¼ ì—´ì–´ì£¼ì„¸ìš”.
- ECS Clusterì— Serviceë¥¼ ìƒì„±í•˜ì„¸ìš”.
  - Launch typeì€ EC2ë¡œ ì„¤ì •í•˜ì„¸ìš”.
  - Application typeì€ Serviceë¡œ ì„¤ì •í•˜ì„¸ìš”.
  - Load Balancerë¥¼ í• ë‹¹í•˜ì„¸ìš”.
  - ìƒì„±ì— ì‹œê°„ì´ ê±¸ë¦´ ìˆ˜ ìˆì–´ìš”. (ì•½ 5ë¶„)
- Serviceì˜ Networking íƒ­ì˜ DNS Nameì„ í™•ì¸í•˜ì„¸ìš”. (Security Group í™•ì¸!)
- CloudFrontì˜ Originì— Load Balancerì˜ DNS Nameì„ ë“±ë¡í•˜ì„¸ìš”.

{{< alert context="warning" text="ì‹¤í–‰ì´ ì œëŒ€ë¡œ ë˜ì§€ ì•ŠëŠ” ê²½ìš°ëŠ” Serviceì˜ Eventsë¥¼ í™•ì¸í•˜ë©´ ë„ì›€ì´ ë¼ìš”." />}}

#### Fargate Launch Type

> TODO
