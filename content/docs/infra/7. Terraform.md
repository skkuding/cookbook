+++
title = "7. Terraform"
description = "í”„ë¡œë¹„ì €ë‹ ë„êµ¬ì¸ Terraformì— ëŒ€í•´ ì•Œì•„ë´…ë‹ˆë‹¤."
icon = "article"
date = "2023-09-11"
lastmod = "2023-10-05"
weight = 370
+++

Terraformì€ HashiCorpì—ì„œ ë§Œë“  ì¸í”„ë¼ í”„ë¡œë¹„ì €ë‹ ë„êµ¬ì…ë‹ˆë‹¤. Terraformì„ ì‚¬ìš©í•˜ë©´ ì½”ë“œë¡œ ì¸í”„ë¼ë¥¼ ê´€ë¦¬í•  ìˆ˜ ìˆì–´ìš”. ì´ë²ˆ ì‹œê°„ì—ëŠ” IaC(Infrastructure as Code)ë¥¼ êµ¬í˜„í•  ìˆ˜ ìˆëŠ” Terraformì— ëŒ€í•´ ì•Œì•„ë³´ê² ìŠµë‹ˆë‹¤.

## ê³µë¶€í•  ë‚´ìš© ğŸ“š

### 1. Terraform

Terraformì„ ì‚¬ìš©í•˜ë©´ ì½”ë“œë¡œ ì¸í”„ë¼ë¥¼ ê´€ë¦¬í•  ìˆ˜ ìˆì–´ìš”. Terraformì€ ë‹¤ì–‘í•œ í´ë¼ìš°ë“œ ì„œë¹„ìŠ¤ë¥¼ ì§€ì›í•˜ê³ , ë‹¤ì–‘í•œ ë¦¬ì†ŒìŠ¤ë¥¼ ê´€ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

- IaC(Infrastructure as Code)ë€ ë¬´ì—‡ì¸ì§€ ì•Œì•„ë´ìš”.
- Terraformì´ ì–´ë–¤ ë„êµ¬ì¸ì§€ ì•Œì•„ë´ìš”.
- Terraformì˜ ì£¼ìš” ìš©ì–´ë¥¼ ì•Œì•„ë´ìš”. (Provider, Resource, State)
- Terraformì˜ ì£¼ìš” ëª…ë ¹ì–´ë¥¼ ì•Œì•„ë´ìš”. (init, plan, apply, destroy)

#### ì°¸ê³  ìë£Œ

- **[44bits "í…Œë¼í¼(Terraform)ì´ë€?"](https://www.44bits.io/ko/keyword/terraform)**: Terraformì˜ ë°°ê²½ë¶€í„° ê°œë…, íŠœí† ë¦¬ì–¼ê¹Œì§€ ì •ë¦¬í•´ë†“ì€ ê¸€ì…ë‹ˆë‹¤.
- **[ì¸í”„ëŸ° Terraform & AWS 101 "Terraform ê¸°ë³¸"](https://terraform101.inflearn.devopsart.dev/preparation/terraform-basic/)**: Terraformì˜ ìš©ì–´ì™€ ëª…ë ¹ì–´ë“¤ì„ ì •ë¦¬í•œ ê¸€ì…ë‹ˆë‹¤.

### 2. HCL ë¬¸ë²•

Terraformì€ HCL(HashiCorp Configuration Language)ì´ë¼ëŠ” ë…ìì ì¸ ì–¸ì–´ë¥¼ ì‚¬ìš©í•´ìš”. HCLì€ JSONê³¼ ë¹„ìŠ·í•œ ë¬¸ë²•ì„ ê°€ì§€ê³  ìˆì–´ìš”.

- HCLì˜ ê¸°ë³¸ ë¬¸ë²•ì„ ì•Œì•„ë´ìš”. (Block, Argument, Expression)
- HCLì˜ ì£¼ìš” í•¨ìˆ˜ë¥¼ ê°„ëµí•˜ê²Œ ì•Œì•„ë´ìš”. (for_each, lookup, file, templatefile)

#### ì°¸ê³  ìë£Œ

- **[GeeksForGeeks "Terraform Syntax With Examples"](https://www.geeksforgeeks.org/terraform-syntax-with-examples/)**: HCLì˜ ê¸°ë³¸ ë¬¸ë²•ì„ ì •ë¦¬í•œ ê¸€ì…ë‹ˆë‹¤.
- **[Terraform Functions](https://developer.hashicorp.com/terraform/language/functions)**: HCLì˜ ì£¼ìš” í•¨ìˆ˜ë“¤ì„ ì •ë¦¬í•œ ê³µì‹ ë¬¸ì„œì…ë‹ˆë‹¤. ì•„ë˜ ë‚´ìš©ì€ ìì„¸íˆ ë³¼ í•„ìš” ì—†ê³ , ê° í•¨ìˆ˜ì˜ ì˜ˆì‹œë¥¼ ë³´ë©´ì„œ ì–´ë–¤ í•¨ìˆ˜ê°€ ìˆëŠ”ì§€ë§Œ í™•ì¸í•´ì£¼ì„¸ìš”.
  - **[Terraform for_each Meta-Argument](https://developer.hashicorp.com/terraform/language/meta-arguments/for_each)**
  - **[Terraform lookup Function](https://developer.hashicorp.com/terraform/language/functions/lookup)**
  - **[Terraform file Function](https://developer.hashicorp.com/terraform/language/functions/file)**
  - **[Terraform templatefile Function](https://developer.hashicorp.com/terraform/language/functions/templatefile)**

## í”„ë¡œì íŠ¸ ì‹¤ìŠµ ğŸˆ

ê·¸ë™ì•ˆ AWSì— êµ¬ì„±í•œ ì¸í”„ë¼ë¥¼ Terraformìœ¼ë¡œ ê´€ë¦¬í•´ë´ìš”. ë‹¤ë§Œ ì¼ì£¼ì¼ ì•ˆì— ì „ë¶€ Terraformìœ¼ë¡œ ì˜®ê¸°ê¸°ì—” ì–‘ì´ ë„ˆë¬´ ë§ì•„ì„œ **CloudFrontì™€ S3ë§Œ** Terraformìœ¼ë¡œ ì˜®ê¸°ëŠ” ê±¸ë¡œ í•´ìš”.

```mermaid
flowchart LR
  subgraph AWS
    subgraph ECS
      ALB --> Node.js
    end
    CloudFront -- /api/* --> ALB
    CloudFront -- /* --> S3
    style CloudFront fill:#ffaa90
    style S3 fill:#ffaa90
  end
  Client -- http://[domain-name] --> CloudFront
```

### AWS CLIë¥¼ ì„¤ì¹˜í•˜ì„¸ìš”.

- [ì§€ë‚œ ì£¼ì°¨ ë‚´ìš©](../infra/6.%20AWS:%20ECS.md#aws-clië¥¼-ì„¤ì¹˜í•˜ì„¸ìš”)ì„ ì°¸ê³ í•´ì£¼ì„¸ìš”.
- `aws s3 ls` ëª…ë ¹ì–´ê°€ ì˜ ì‹¤í–‰ë˜ëŠ”ì§€ í™•ì¸í•´ì£¼ì„¸ìš”.

### Terraformì„ ì„¤ì¹˜í•˜ì„¸ìš”.

- [Terraform ê³µì‹ ì‚¬ì´íŠ¸](https://www.terraform.io/downloads.html)ì—ì„œ Terraformì„ ë‹¤ìš´ë°›ì•„ ì„¤ì¹˜í•˜ì„¸ìš”.
- VSCodeì— "HashiCorp Terraform" í™•ì¥ í”„ë¡œê·¸ë¨ì„ ì„¤ì¹˜í•˜ì„¸ìš”.

### AWS Providerë¡œ S3ë¥¼ êµ¬ì„±í•˜ì„¸ìš”.

{{< alert context="info" text="Terraformì„ ì“°ë‹¤ë³´ë©´ ë¬¸ì„œ ë³¼ ì¼ì´ ì•„ì£¼ ë§ì„ ê±°ì˜ˆìš”. í•œ ìª½ ì°½ì€ ë¬¸ì„œ, ë‹¤ë¥¸ ìª½ ì°½ì€ ì—ë””í„°ë¥¼ ë„ì›Œë†“ê³  ê°œë°œí•˜ëŠ” ê±¸ ì¶”ì²œë“œë¦½ë‹ˆë‹¤. ğŸ˜º" />}}

> AWS Provider ê³µì‹ ë¬¸ì„œ: https://registry.terraform.io/providers/hashicorp/aws/latest/docs

- [ê³µì‹ ë¬¸ì„œ ì˜ˆì‹œ](https://registry.terraform.io/providers/hashicorp/aws/latest/docs#example-usage)ì²˜ëŸ¼ íŒŒì¼ì„ ë§Œë“¤ì–´ì£¼ì„¸ìš”. (ì˜ˆ: main.tf) Regionì€ `ap-northeast-2`ë¡œ ì„¤ì •í•˜ì„¸ìš”.
- `terraform init` ëª…ë ¹ì–´ë¡œ AWS Providerë¥¼ ì„¤ì¹˜í•˜ì„¸ìš”.
- `terraform plan` ëª…ë ¹ì–´ë¡œ AWSì— ì ìš©í•  ë‚´ìš©ì„ í™•ì¸í•˜ì„¸ìš”.
- `terraform apply` ëª…ë ¹ì–´ë¡œ AWSì— ì ìš©í•˜ì„¸ìš”.
- AWSì— VPCê°€ ì˜ ìƒì„±ë˜ì—ˆëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”. [VPC Console ë§í¬](https://ap-northeast-2.console.aws.amazon.com/vpcconsole/home?region=ap-northeast-2)
- `terraform destroy` ëª…ë ¹ì–´ë¡œ AWSì— ìƒì„±í•œ ë¦¬ì†ŒìŠ¤ë¥¼ ì‚­ì œí•˜ì„¸ìš”.

#### 1ï¸âƒ£ S3 Bucketì„ ìƒì„±í•˜ì„¸ìš”.

[aws_s3_bucket ë¬¸ì„œ](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/s3_bucket)ë¥¼ ì°¸ê³ í•´ì„œ S3 Bucketì„ ìƒì„±í•˜ì„¸ìš”.

#### 2ï¸âƒ£ S3ì— íŒŒì¼ì„ ì—…ë¡œë“œí•˜ì„¸ìš”.

[aws_s3_object ë¬¸ì„œ](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/s3_object)ë¥¼ ì°¸ê³ í•´ì„œ S3ì— íŒŒì¼ì„ ì—…ë¡œë“œí•˜ì„¸ìš”.

- 5ì£¼ì°¨ ì‹¤ìŠµì˜ HTML, CSS, JS íŒŒì¼ì„ ê°ê° ì˜¬ë ¤ì£¼ì„¸ìš”.
- content_typeì„ `text/html`, `text/css`, `application/javascript`ë¡œ ì„¤ì •í•´ì£¼ì„¸ìš”.
- etagë¥¼ ì„¤ì •í•´ì£¼ì„¸ìš”. ê·¸ë˜ì•¼ íŒŒì¼ ë‚´ìš©ì´ ë³€ê²½ëì„ ë•Œ ë‹¤ì‹œ ì—…ë¡œë“œí•  ìˆ˜ ìˆì–´ìš”.

#### 3ï¸âƒ£ S3 websiteë¥¼ êµ¬ì„±í•˜ì„¸ìš”.

[aws_s3_bucket_website_configuration ë¬¸ì„œ](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/s3_bucket_website_configuration)ë¥¼ ì°¸ê³ í•´ì„œ S3 websiteë¥¼ êµ¬ì„±í•˜ì„¸ìš”.

- IAM Policyë¥¼ 5ì£¼ì°¨ ë‚´ìš©ì²˜ëŸ¼ ì„¤ì¡í•´ì£¼ì„¸ìš”. [aws_iam_policy_document ë¬¸ì„œ](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/data-sources/iam_policy_document)
- IAM Policy Documentë¥¼ S3ì— ì—°ê²°í•´ì£¼ì„¸ìš”. [s3_bucket_policy ë¬¸ì„œ](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/s3_bucket_policy)
- Public Access Blockì„ í•´ì œí•´ì£¼ì„¸ìš”. [aws_s3_bucket_public_access_block ë¬¸ì„œ](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/s3_bucket_public_access_block)
- ì›¹ì‚¬ì´íŠ¸ ì ‘ì†ì´ ì˜ ë˜ëŠ”ì§€ í™•ì¸í•´ë³´ì„¸ìš”.

#### 4ï¸âƒ£ CloudFrontë¥¼ ìƒì„±í•˜ì„¸ìš”.

[aws_cloudfront_distribution ë¬¸ì„œ](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/cloudfront_distribution)ë¥¼ ì°¸ê³ í•´ì„œ CloudFrontë¥¼ ìƒì„±í•˜ì„¸ìš”.

- ìƒì„±ì— ì‹œê°„ì´ ì¢€ ê±¸ë¦´ ìˆ˜ ìˆì–´ìš”.
- S3 Bucketì„ Originìœ¼ë¡œ ì„¤ì •í•´ì£¼ì„¸ìš”.
- ì§€ë‚œ ì£¼ì°¨ ì‹¤ìŠµì—ì„œ ë§Œë“  ALBë¥¼ data sourceë¡œ ê°€ì ¸ì™€ Originìœ¼ë¡œ ì„¤ì •í•´ì£¼ì„¸ìš”. [aws_lb ë¬¸ì„œ](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/data-sources/lb)
- `default_cache_behavior`ì— S3ë¥¼, `ordered_cache_behavior`ì— ALBë¥¼ ì¶”ê°€í•´ì£¼ì„¸ìš”.
- CloudFront ì ‘ì†ì´ ì˜ ë˜ëŠ”ì§€ í™•ì¸í•´ë³´ì„¸ìš”.
